<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OCR Processor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.0/tesseract.min.js"></script>
</head>
<body>
<script>
// Function to perform OCR
async function performOCR(imageDataUrl) {
    try {
        const { data: { text } } = await Tesseract.recognize(
            imageDataUrl,
            'eng',
            { logger: m => console.log(m) }
        );
        console.log(text)
        return text.trim();
    } catch (error) {
        console.error("OCR Error:", error);
        throw error;
    }
}

// Handle messages from parent window
window.addEventListener('message', async (event) => {
    // Security: Verify origin in production
    // if (event.origin !== "https://your-extension-origin.com") return;
    
    if (event.data.type === 'processImage') {
        try {
            const text = await performOCR(event.data.imageDataUrl);
            // Send result back to parent
            window.parent.postMessage({
                type: 'ocrResult',
                text: text
            }, '*'); // Replace * with specific origin in production
        } catch (error) {
            window.parent.postMessage({
                type: 'ocrError',
                error: error.message
            }, '*');
        }
    }
});

// Notify parent that OCR is ready
if (window.parent !== window) {
    window.parent.postMessage({ type: 'ocrReady' }, '*');
}
</script>
</body>
</html>