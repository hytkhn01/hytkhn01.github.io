<html lang="en"><head>
  <meta charset="UTF-8">
  

    <link rel="apple-touch-icon" type="image/png" href="https://cpwebassets.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png">

    <meta name="apple-mobile-web-app-title" content="CodePen">

    <link rel="icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico">

    <link rel="mask-icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111">



  
    <script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-2c7831bb44f98c1391d6a4ffda0e1fd302503391ca806e7fcc7b9b87197aec26.js"></script>


  <title>Real-Time Capture Tool with OCR - Tesseract.js</title>

    <link rel="canonical" href="https://codepen.io/Baiawai/pen/YzRyKYv">
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-bootstrap/0.5pre/assets/css/bootstrap.min.css">
  
<style>
#captureContainer {
      width: 60%;
      position: relative;
      display: inline-block;
      -moz-user-select: none;
      /* Firefox */
      -webkit-user-select: none;
      /* Chrome, Safari, Opéra depuis la version 15 */
      -ms-user-select: none;
      /* Internet explorer depuis la version 10 et Edge */
      user-select: none;
      /* Propriété standard */
    }

    img {
      -moz-user-select: none;
      /* Firefox */
      -webkit-user-select: none;
      /* Chrome, Safari, Opéra depuis la version 15 */
      -ms-user-select: none;
      /* Internet explorer depuis la version 10 et Edge */
      user-select: none;
      /* Propriété standard */
    }

    .para {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      background: transparent;
      z-index: 500;
    }
    .panel{
      display: flex;
      align-items: center;
      justify-content: left;
    }
    #preview {
      width: 39%;
      position: relative;
      display: inline-block;
      vertical-align: top;
      height: 500px;
    }

    #preview img {
      max-width: 100%;
      max-height: 300px;
    }

    .preview_font {
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f2f2f2;
      padding: 20px;

    }

    #screenshot {
      max-width: 100%;
      width: auto;
      display: block;
      overflow: hidden;
      display: inline-block;
      z-index: 100;
    }

    #draggable {
      width: 30%;
      height: 10%;
      min-height: 10px;
      min-width: 10px;
      max-height: 100%;
      max-width: 100%;
      position: absolute;
      border: 2px dashed lime;
      background: transparent;
      display: none;
      cursor: move;
      z-index: 1000;
    }

    .resize-button {
      position: absolute;
      background-color: #fff;
      border: 1px solid #000;
      border-radius: 50%;
      width: 10px;
      height: 10px;

    }

    #resizeTop {
      top: -7px;
      left: 50%;
      transform: translateX(-50%);
      cursor: n-resize;
    }

    #resizeBottom {
      bottom: -7px;
      left: 50%;
      transform: translateX(-50%);
      cursor: s-resize;
    }

    #resizeLeft {
      top: 50%;
      left: -7px;
      transform: translateY(-50%);
      cursor: w-resize;
    }

    #resizeRight {
      top: 50%;
      right: -7px;
      transform: translateY(-50%);
      cursor: e-resize;
    }
</style>

  
  
  
</head>

<body translate="no">
  


  <title>Pen by Baiawai</title>



  <div class="panel">
    <button id="startButton" onclick="startCapture()">Start Capture</button>
    <button id="stopButton" onclick="stopCapture()" disabled="">Stop Capture</button>
    <select id="couleur">
      <option value="lime" selected="">Lime</option>
      <option value="red">Rouge</option>
      <option value="green">Vert</option>
      <option value="blue">Bleu</option>
      <option value="yellow">Jaune</option>
      <option value="orange">Orange</option>
    </select>
    <select id="langSelect">

      <option value="eng" selected="">English</option>
      <option value="fra">French</option>
    </select>
    <select id="filterSelect">
      <option value="none">No Filter</option>
      <option value="grayscale">Grayscale</option>
      <option value="blur">Blur</option>
      <option value="sepia">Sepia</option>
      <option value="brightness">Brightness</option>
      <option value="invert">Invert Colors</option>
      <option value="hue">HUE</option>
    </select>
    <label for="intervalInput">Capture Interval: </label>
    <input type="number" id="intervalInput" value="1">

  </div>

  <div id="captureContainer">
    <div>
      <div class="para"></div>
      <img id="screenshot">
      <div id="draggable" class="ui-widget-content ui-draggable ui-draggable-handle">
        <div id="resizeTop" class="resize-button" onmousedown="startResize(event, 'top')"></div>
        <div id="resizeBottom" class="resize-button" onmousedown="startResize(event, 'bottom')"></div>
        <div id="resizeLeft" class="resize-button" onmousedown="startResize(event, 'left')"></div>
        <div id="resizeRight" class="resize-button" onmousedown="startResize(event, 'right')"></div>
      </div>
    </div>
  </div>

  <div id="preview">
    <div class="preview_font">

      <img id="croppedImage">
    </div>
    <h3>Résultat OCR</h3>
    <p id="ocrResult"></p>
  </div>

  <video id="screenVideo" style="display: none;"></video>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.0/tesseract.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
      <script id="rendered-js">
let shouldCapture = false,
videoTrack,
originalImageWidth,
originalImageHeight,
currentResizeDirection,
initialResizeSize,
screenshotElement = document.getElementById("captureContainer"),
captureInterval = 1000;

$("#draggable").draggable({
  containment: "parent",
  start: function (event, ui) {
    $(".resize-button").hide();
  },
  stop: function (event, ui) {
    $(".resize-button").show();
    const xPos =
    ui.position.left * originalImageWidth / $("#screenshot").width();
    const yPos =
    ui.position.top * originalImageHeight / $("#screenshot").height();
    const size = this.getBoundingClientRect();
    const widthRatio = size.width / $("#screenshot").width();
    const heightRatio = size.height / $("#screenshot").height();
  } });



function startResize(event, direction) {

  if (event.target.classList.contains("resize-button")) {

    currentResizeDirection = direction;
    let $draggable = $("#draggable");
    $draggable.draggable("disable");
    let $parent = $draggable.parent();

    parentOffset = $parent.offset();

    initialResizePosition = {
      x: event.pageX - parentOffset.left,
      y: event.pageY - parentOffset.top };


    initialResizeSize = {
      x: $draggable.position().left,
      y: $draggable.position().top,
      width: $draggable.width(),
      height: $draggable.height() };


    $(document).on("mousemove", resize);
    $(document).on("mouseup", stopResize);
  }
}







function resize(event) {

  let diffX = event.pageX - parentOffset.left - initialResizePosition.x;
  let diffY = event.pageY - parentOffset.top - initialResizePosition.y;
  let newWidth = initialResizeSize.width;
  let newHeight = initialResizeSize.height;
  let newX = initialResizeSize.x;
  let newY = initialResizeSize.y;

  switch (currentResizeDirection) {
    case "top":
      newHeight = Math.max(initialResizeSize.height - diffY, 0);
      newY = Math.min(initialResizePosition.y + diffY, initialResizeSize.y + initialResizeSize.height);
      break;
    case "bottom":
      newHeight = Math.max(initialResizeSize.height + diffY, 0);
      break;
    case "left":
      newWidth = Math.max(initialResizeSize.width - diffX, 0);
      newX = Math.min(initialResizePosition.x + diffX, initialResizeSize.x + initialResizeSize.width);
      break;
    case "right":
      newWidth = Math.max(initialResizeSize.width + diffX, 0);
      break;}


  let $draggable = $("#draggable");
  let draggableWidth = $draggable.width();
  let draggableHeight = $draggable.height();
  let containerRect = $("#screenshot").get(0).getBoundingClientRect();
  let containerWidth = containerRect.width;
  let containerHeight = containerRect.height;

  newX = clamp(newX, 0, containerWidth - draggableWidth);
  newY = clamp(newY, 0, containerHeight - draggableHeight);

  $draggable.css({
    top: newY,
    left: newX,
    width: newWidth,
    height: newHeight });

}







function stopResize() {

  let $draggable = $("#draggable");
  let size = $draggable.get(0).getBoundingClientRect();
  let xPos = $draggable.position().left * originalImageWidth / screenshotElement.width;
  let yPos = $draggable.position().top * originalImageHeight / screenshotElement.height;
  let widthRatio = $draggable.css('width') / screenshotElement.width;
  let heightRatio = $draggable.css('height') / screenshotElement.height;

  xPos = clamp(xPos, 0, originalImageWidth - originalImageWidth * widthRatio);
  yPos = clamp(yPos, 0, originalImageHeight - originalImageHeight * heightRatio);

  $draggable.css({
    top: yPos * $('#screenshot').css('height') / originalImageHeight,
    left: xPos * $('#screenshot').css('width') / originalImageWidth });


  if ($draggable.css('width') > originalImageWidth) {
    $draggable.css('width', originalImageWidth);
  }

  if ($draggable.css('height') > originalImageHeight) {
    $draggable.css('height', originalImageHeight);
  }

  initialResizeSize = {
    x: $draggable.position().left,
    y: $draggable.position().top,
    width: $draggable.width(),
    height: $draggable.height() };


  $("#draggable").draggable("enable");

  $(document).off("mousemove", resize);
  $(document).off("mouseup", stopResize);
}

function cropImageAndSend(x, y, width, height, imageURL, filter) {
  const draggable = document.getElementById("draggable");
  const screenshotRect = document.
  getElementById("screenshot").
  getBoundingClientRect();
  const draggableRect = draggable.getBoundingClientRect();

  let xPos =
  (draggableRect.left - screenshotRect.left) * originalImageWidth /
  screenshotRect.width;
  let yPos =
  (draggableRect.top - screenshotRect.top) * originalImageHeight /
  screenshotRect.height;
  const widthRatio = width / screenshotRect.width;
  const heightRatio = height / screenshotRect.height;

  const canvas = document.createElement("canvas");
  canvas.width = width;
  canvas.height = height;
  const context = canvas.getContext("2d");
  const image = new Image();
  image.onload = function () {
    // Appliquer le filtre personnalisé au contexte du canevas
    if (filter === "brightness") {
      // Exemple de filtre de luminosité
      context.filter = "brightness(150%)";
    } else if (filter === "sepia") {
      // Exemple de filtre de sépia
      context.filter = "sepia(1)";
    } else if (filter === "blur") {
      // Exemple de filtre de flou
      context.filter = "blur(5px)";
    } else if (filter === "grayscale") {
      // Exemple de filtre de niveau de gris
      context.filter = "grayscale(100%)";
    } else if (filter === "invert") {
      // Exemple de filtre d'inversion des couleurs
      context.filter = "invert(100%)";
    } else if (filter === "hue") {
      // Exemple de filtre de teinte
      context.filter = "hue-rotate(90deg)";
    } else {
      context.filter = "none";
    }
    context.drawImage(image, x, y, width, height, 0, 0, width, height);
    const croppedImageURL = canvas.toDataURL("image/png");
    const selectElement = document.getElementById("langSelect");
    Tesseract.recognize(croppedImageURL, selectElement.value, {
      logger: () => {} }).

    then(({ data: { text } }) => {
      const recognizedText = text.trim();

      const croppedImage = document.getElementById("croppedImage");
      croppedImage.src = croppedImageURL;

      const ocrResult = document.getElementById("ocrResult");
      ocrResult.textContent = recognizedText;
    }).
    catch(error => {
      console.error("Erreur lors de la reconnaissance OCR :", error);
    });
  };
  image.src = imageURL;
}

function captureAndDisplay() {
  const video = document.getElementById("screenVideo");
  const screenshot = document.getElementById("screenshot");
  const draggable = document.getElementById("draggable");

  if (
  video &&
  screenshot &&
  draggable &&
  video.readyState === video.HAVE_ENOUGH_DATA)
  {
    $("#draggable").show();
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const context = canvas.getContext("2d");
    context.drawImage(video, 0, 0);
    originalImageWidth = video.videoWidth;
    originalImageHeight = video.videoHeight;
    const imageURL = canvas.toDataURL("image/png");
    screenshot.setAttribute("src", imageURL);
    screenshot.onload = function () {
      const screenshotRect = screenshot.getBoundingClientRect();
      const draggableRect = draggable.getBoundingClientRect();
      const selectedFilter = filterSelect.value;
      applyFilter(selectedFilter);

      const xPos =
      (draggableRect.left - screenshotRect.left) * originalImageWidth /
      screenshotRect.width;
      const yPos =
      (draggableRect.top - screenshotRect.top) * originalImageHeight /
      screenshotRect.height;
      const width =
      draggableRect.width * originalImageWidth / screenshotRect.width;
      const height =
      draggableRect.height * originalImageHeight / screenshotRect.height;
      cropImageAndSend(xPos, yPos, width, height, imageURL, selectedFilter);
    };
  }

  if (shouldCapture) {
    setTimeout(captureAndDisplay, captureInterval);
  }
}

function startCapture() {
  const startButton = document.getElementById("startButton");
  const stopButton = document.getElementById("stopButton");
  const intervalInput = document.getElementById("intervalInput");
  const draggable = document.getElementById("draggable");
  const captureContainer = document.getElementById("captureContainer");
  const video = document.getElementById("screenVideo");

  if (
  !startButton ||
  !stopButton ||
  !intervalInput ||
  !draggable ||
  !captureContainer ||
  !video)
  {
    console.error("Certains éléments nécessaires sont introuvables.");
    return;
  }

  startButton.disabled = true;
  stopButton.disabled = false;
  shouldCapture = true;
  screenshotElement = captureContainer;
  captureInterval = intervalInput.value * 1000;

  $("#draggable").css({ top: 0, left: 0 });
  navigator.mediaDevices.
  getDisplayMedia({ video: true }).
  then(function (stream) {
    videoTrack = stream.getVideoTracks()[0];
    video.srcObject = stream;
    video.onloadedmetadata = function (e) {
      video.play();
      originalImageWidth = video.videoWidth;
      originalImageHeight = video.videoHeight;
      captureAndDisplay();
    };
  }).
  catch(function (error) {
    console.error(
    "Erreur lors de l'obtention de l'autorisation de capture d'écran :",
    error);

    // Afficher un message d'erreur approprié à l'utilisateur
  });
}

function stopCapture() {
  document.getElementById("startButton").disabled = false;
  document.getElementById("stopButton").disabled = true;
  shouldCapture = false;
  if (videoTrack) {
    try {
      videoTrack.stop();
    } catch (error) {
      console.error("Erreur lors de l'arrêt de la capture d'écran :", error);
    }
  }
  const video = document.getElementById("screenVideo");
  video.srcObject = null;
}

function applyFilter(filter) {
  const screenshot = document.getElementById("screenshot");
  if (filter === "brightness") {
    // Exemple de filtre de luminosité
    screenshot.style.filter = "brightness(150%)";
  } else if (filter === "sepia") {
    // Exemple de filtre de sépia
    screenshot.style.filter = "sepia(1)";
  } else if (filter === "blur") {
    // Exemple de filtre de flou
    screenshot.style.filter = "blur(5px)";
  } else if (filter === "grayscale") {
    // Exemple de filtre de niveau de gris
    screenshot.style.filter = "grayscale(100%)";
  } else if (filter === "invert") {
    // Exemple de filtre d'inversion des couleurs
    screenshot.style.filter = "invert(100%)";
  } else if (filter === "hue") {
    // Exemple de filtre de teinte
    screenshot.style.filter = "hue-rotate(90deg)";
  } else {
    screenshot.style.filter = "none";
  }
}

const filterSelect = document.getElementById("filterSelect");
filterSelect.addEventListener("change", function () {
  const selectedFilter = filterSelect.value;
  applyFilter(selectedFilter);
});

const selectElement = document.getElementById("couleur");
const draggableElement = document.getElementById("draggable");

selectElement.addEventListener("change", function () {
  const selectedColor = selectElement.value;
  draggableElement.style.border = `2px dashed ${selectedColor}`;
});

document.
getElementById("intervalInput").
addEventListener("change", function () {
  const intervalInput = document.getElementById("intervalInput");
  captureInterval = intervalInput.value * 1000; // Mettre à jour la valeur de captureInterval en millisecondes
});

function clamp(value, min, max) {
  return Math.max(min, Math.min(value, max));
}
//# sourceURL=pen.js
    </script>

  
  <script src="https://cpwebassets.codepen.io/assets/editor/iframe/iframeRefreshCSS-44fe83e49b63affec96918c9af88c0d80b209a862cf87ac46bc933074b8c557d.js"></script>



</body></html>